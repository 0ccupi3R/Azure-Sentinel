id: fda90754-4e22-4bb1-8b99-2bb49a991eae
name: High reverse DNS count by host
description: |
  'Clients with a high reverse DNS count could be carrying out reconnaissance or discovery activity.'
requiredDataConnectors: []
tactics:
  - Discovery
relevantTechniques:
  - T1046
query: |
  let threshold = 10;
  ppDns(domain_has_any="in-addr.arpa") 
  //| where Name contains "in-addr.arpa" 
  | summarize StartTimeUtc = min(TimeGenerated), EndTimeUtc = max(TimeGenerated), NameCount = dcount(DnsQuery), Names = make_set(DnsQuery), ClientIPCount = count() by SrcIpAddr
  | where NameCount > threshold
  | extend timestamp = StartTimeUtc, IPCustomEntity = SrcIpAddr
